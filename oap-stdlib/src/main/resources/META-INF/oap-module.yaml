name: oap
services:
  oap-http-io-server:
    implementation: oap.http.server.apache.ApacheHttpServer
    profile: http-io
    name: oap-http-server
    parameters:
      workers: 500
      queueSize: 0
      registerStatic: false
      keepAliveTimeout: 5s
      originalServer: "OAP Server/4.0"
      responseDate: true
      healthHttpHandler: "@service:oap-http-health-handler"
      rejected:
        code: 503
        reason: "temporary overload"
    supervision:
      supervise: true

  oap-http-listener-plain:
    profile: http-io-plain
    implementation: oap.http.server.apache.PlainHttpListener
    parameters:
      port: 8880
      server: "@service:oap-http-server"
    supervision:
      thread: true

  oap-http-listener-ssl:
    profile: http-io-ssl
    implementation: oap.http.server.apache.SslHttpListener
    parameters:
      port: 8443
      server: "@service:oap-http-server"
      keystoreLocation: "/etc/oap/keystore.jks"
      keystorePassword: "changeit"
    supervision:
      thread: true

  local-http-listener:
    profile: http-io-local
    implementation: oap.http.server.apache.LocalHttpListener
    parameters:
      port: 18546
      server: "@service:oap-http-server"
    supervision:
      thread: true

  oap-http-health-handler:
    implementation: oap.http.server.health.HealthHttpHandler
    parameters:
      providers:
        - "@implementations:oap.http.server.health.HealthDataProvider"

  remoting:
    profile: remoting
    implementation: oap.application.remote.Remote
    parameters:
      port: 8980
      context: /remote/
      serialization: DEFAULT
      kernel: "@kernel"
      timeout: 1m
    supervision:
      supervise: true

  prometheus-jvm-exporter:
    implementation: oap.prometheus.PrometheusJvmExporter
    parameters:
      enableClassLoaderMetrics: true
      enableJvmMemoryMetrics: true
      enableJvmGcMetrics: true
      enableLogbackMetrics: true
      enableJvmThreadMetrics: true
    supervision:
      supervise: true

  prometheus-application-info-exporter:
    implementation: oap.prometheus.PrometheusApplicationInfoExporter
    supervision:
      supervise: true
